<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Reputation Badge Component</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-tertiary: #e5e7eb;
            --text-primary: #1f2937;
            --text-muted: #6b7280;
            --border: #d1d5db;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 10px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #6366f1;
        }
        
        .badge-display {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #4f46e5;
        }
        
        .mock-controls {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-success {
            background: #10b981;
        }
        
        .status-error {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéñÔ∏è Reputation Badge Component Test</h1>
        
        <div class="test-section">
            <h3>Component Status</h3>
            <div id="component-status"></div>
        </div>
        
        <div class="mock-controls">
            <h3>Test Controls</h3>
            <div>
                <label>User ID: </label>
                <input type="text" id="userId" value="test-user-123" />
                <button onclick="testGetReputation()">Test Get Reputation</button>
                <button onclick="testCompactBadge()">Test Compact Badge</button>
                <button onclick="testFullBadge()">Test Full Badge</button>
            </div>
            
            <div style="margin-top: 10px;">
                <label>Mock Data: </label>
                <select id="mockDataType" onchange="updateMockData()">
                    <option value="rookie">Rookie (New User)</option>
                    <option value="veteran">Veteran (Experienced)</option>
                    <option value="legend">Legend (Top Tier)</option>
                    <option value="null">No Data (Error Case)</option>
                </select>
            </div>
        </div>
        
        <div class="badge-display">
            <h3>Compact Badge Preview</h3>
            <div id="compact-badge-output"></div>
        </div>
        
        <div class="badge-display">
            <h3>Full Badge Preview</h3>
            <div id="full-badge-output"></div>
        </div>
        
        <div class="test-section">
            <h3>Test Results</h3>
            <div id="test-results"></div>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
    </div>

    <script type="module">
        // Import the migrated component
        import { reputationBadge } from '/js/components/reputation-badge.js';
        import { apiService } from '/js/core/services/api-service.js';
        
        // Make available globally for button clicks
        window.reputationBadge = reputationBadge;
        
        const resultsDiv = document.getElementById('test-results');
        
        // Mock data for testing
        const mockData = {
            rookie: {
                success: true,
                reputation: {
                    trustLevel: {
                        level: 'Rookie',
                        stars: 1,
                        color: '#6b7280'
                    },
                    overallScore: 65,
                    totalBets: 5,
                    completedBets: 3,
                    wonBets: 1,
                    paymentScore: 75,
                    avgPaymentTime: 48,
                    currentStreak: -1,
                    badges: [],
                    paymentMethods: [
                        { type: 'venmo', verified: false }
                    ]
                }
            },
            veteran: {
                success: true,
                reputation: {
                    trustLevel: {
                        level: 'Veteran',
                        stars: 4,
                        color: '#10b981'
                    },
                    overallScore: 88,
                    totalBets: 150,
                    completedBets: 142,
                    wonBets: 78,
                    paymentScore: 92,
                    avgPaymentTime: 3.5,
                    currentStreak: 3,
                    badges: ['fast-payer', 'reliable', 'verified'],
                    paymentMethods: [
                        { type: 'venmo', verified: true },
                        { type: 'cashapp', verified: true },
                        { type: 'crypto', verified: false }
                    ]
                }
            },
            legend: {
                success: true,
                reputation: {
                    trustLevel: {
                        level: 'Legend',
                        stars: 5,
                        color: '#fbbf24'
                    },
                    overallScore: 98,
                    totalBets: 500,
                    completedBets: 495,
                    wonBets: 280,
                    paymentScore: 100,
                    avgPaymentTime: 0.5,
                    currentStreak: 12,
                    badges: ['fast-payer', 'reliable', 'high-roller', 'verified', 'founding-member', 'dispute-free'],
                    paymentMethods: [
                        { type: 'venmo', verified: true },
                        { type: 'cashapp', verified: true },
                        { type: 'zelle', verified: true },
                        { type: 'paypal', verified: true },
                        { type: 'crypto', verified: true }
                    ]
                }
            },
            null: {
                success: false,
                reputation: null
            }
        };
        
        let currentMockData = mockData.rookie;
        
        // Override API call for testing
        const originalGet = apiService.get;
        apiService.get = async function(endpoint) {
            if (endpoint.includes('/api/reputation/')) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 300));
                return currentMockData;
            }
            return originalGet.call(this, endpoint);
        };
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
        }
        
        function updateComponentStatus() {
            const statusDiv = document.getElementById('component-status');
            const isLoaded = typeof reputationBadge !== 'undefined';
            
            statusDiv.innerHTML = `
                <p><span class="status-indicator ${isLoaded ? 'status-success' : 'status-error'}"></span>
                Component Loaded: ${isLoaded ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p>Methods Available: 
                    ${typeof reputationBadge?.getUserReputation === 'function' ? '‚úÖ' : '‚ùå'} getUserReputation,
                    ${typeof reputationBadge?.renderCompactBadge === 'function' ? '‚úÖ' : '‚ùå'} renderCompactBadge,
                    ${typeof reputationBadge?.renderFullBadge === 'function' ? '‚úÖ' : '‚ùå'} renderFullBadge
                </p>
                <p>Cache Size: ${reputationBadge?.reputationCache?.size || 0} entries</p>
            `;
        }
        
        window.updateMockData = function() {
            const type = document.getElementById('mockDataType').value;
            currentMockData = mockData[type];
            addResult(`Mock data set to: ${type}`, 'info');
        }
        
        window.testGetReputation = async function() {
            const userId = document.getElementById('userId').value;
            addResult(`Testing getUserReputation for: ${userId}`, 'info');
            
            try {
                const reputation = await reputationBadge.getUserReputation(userId);
                if (reputation) {
                    addResult(`‚úÖ Got reputation data: Score ${reputation.overallScore}, Level: ${reputation.trustLevel.level}`, 'success');
                    console.log('Reputation data:', reputation);
                } else {
                    addResult('‚ùå No reputation data returned', 'error');
                }
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        window.testCompactBadge = async function() {
            const userId = document.getElementById('userId').value;
            addResult('Testing compact badge render...', 'info');
            
            try {
                const reputation = await reputationBadge.getUserReputation(userId);
                const html = reputationBadge.renderCompactBadge(reputation);
                
                document.getElementById('compact-badge-output').innerHTML = html;
                addResult('‚úÖ Compact badge rendered', 'success');
            } catch (error) {
                addResult(`‚ùå Error rendering compact badge: ${error.message}`, 'error');
            }
        }
        
        window.testFullBadge = async function() {
            const userId = document.getElementById('userId').value;
            addResult('Testing full badge render...', 'info');
            
            try {
                const reputation = await reputationBadge.getUserReputation(userId);
                const html = reputationBadge.renderFullBadge(reputation);
                
                document.getElementById('full-badge-output').innerHTML = html;
                addResult('‚úÖ Full badge rendered', 'success');
            } catch (error) {
                addResult(`‚ùå Error rendering full badge: ${error.message}`, 'error');
            }
        }
        
        window.runAllTests = async function() {
            clearResults();
            addResult('<h4>Running All Tests...</h4>', 'info');
            
            // Test 1: Component loaded
            if (typeof reputationBadge !== 'undefined') {
                addResult('‚úÖ Component loaded successfully', 'success');
            } else {
                addResult('‚ùå Component not loaded', 'error');
                return;
            }
            
            // Test 2: Get reputation
            await testGetReputation();
            
            // Test 3: Render compact badge
            await testCompactBadge();
            
            // Test 4: Render full badge
            await testFullBadge();
            
            // Test 5: Cache functionality
            const userId = document.getElementById('userId').value;
            const firstCall = await reputationBadge.getUserReputation(userId);
            const secondCall = await reputationBadge.getUserReputation(userId);
            
            if (firstCall === secondCall && reputationBadge.reputationCache.has(userId)) {
                addResult('‚úÖ Cache working correctly', 'success');
            } else {
                addResult('‚ùå Cache not working', 'error');
            }
            
            // Test 6: Error handling
            currentMockData = mockData.null;
            const errorTest = await reputationBadge.getUserReputation('error-test');
            if (errorTest === null) {
                addResult('‚úÖ Error handling works', 'success');
            } else {
                addResult('‚ùå Error handling failed', 'error');
            }
            
            // Reset mock data
            currentMockData = mockData.rookie;
            
            addResult('<h4>All tests complete!</h4>', 'info');
        }
        
        window.clearResults = function() {
            resultsDiv.innerHTML = '';
            document.getElementById('compact-badge-output').innerHTML = '';
            document.getElementById('full-badge-output').innerHTML = '';
        }
        
        // Initial setup
        updateComponentStatus();
        
        // Auto-run tests
        setTimeout(() => {
            testCompactBadge();
            testFullBadge();
        }, 500);
    </script>
</body>
</html>